<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0,viewport-fit=cover">
  <title>My LIFF app</title>
  <link rel="stylesheet" href="css/style.css" media="all">
</head>
<body>
  <textarea id="freeText" maxlength="200"></textarea>

  <h2>เลือกรูปภาพ</h2>
  <input type="radio" id="pic1" name="picture" value="https://sparkth.io/wp-content/uploads/2023/12/HNY-2024.001.jpeg">
  <label for="pic1"><img src="https://sparkth.io/wp-content/uploads/2023/12/HNY-2024.001.jpeg" alt="Pic 1"></label><br>

  <input type="radio" id="pic2" name="picture" value="https://sparkth.io/wp-content/uploads/2023/12/HNY-2024.001.jpeg">
  <label for="pic2"><img src="https://sparkth.io/wp-content/uploads/2023/12/HNY-2024.001.jpeg" alt="Pic 2"></label><br>

  <input type="radio" id="pic3" name="picture" value="https://sparkth.io/wp-content/uploads/2023/12/HNY-2024.001.jpeg">
  <label for="pic3"><img src="https://sparkth.io/wp-content/uploads/2023/12/HNY-2024.001.jpeg" alt="Pic 3"></label><br>

  <input type="radio" id="pic4" name="picture" value="https://sparkth.io/wp-content/uploads/2023/12/HNY-2024.001.jpeg">
  <label for="pic4"><img src="https://sparkth.io/wp-content/uploads/2023/12/HNY-2024.001.jpeg" alt="Pic 4"></label><br>

  <h2>หรือใส่ URL รูปภาพขนาด 1.5:1</h2>
  <input type="url" id="urlPic" value="https://example.com/image.jpg">

  <button id="shareButton">แชร์</button>
  <pre id="flexMessageJson"></pre>

  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <script>
    async function shareMsg() {
      // ดึงข้อความจาก textarea
      const freeText = document.getElementById("freeText").value;

      // ดึง URL รูปภาพจาก radio button
      let imageUrl;
      const selectedImage = document.querySelector('input[name="picture"]:checked');
      if (selectedImage) {
        imageUrl = selectedImage.value;
      } else {
        // ถ้าไม่ได้เลือกรูปภาพจาก radio button ให้ใช้ URL จาก input type="url"
        imageUrl = document.getElementById("urlPic").value;
      }

      // ดึงข้อมูล profile ของผู้ใช้
      const profile = await liff.getProfile();

      // สร้าง Flex Message
      const flexMessage = {
        type: "flex",
        altText: `สุขสันต์วันปีใหม่ 2025 นะ โดย ${profile.displayName}`,
        contents: {
          "type": "bubble",
          "size": "giga",
          "hero": {
            "type": "image",
            "url": imageUrl,
            "aspectRatio": "1.5:1",
            "aspectMode": "cover",
            "size": "full"
          },
          "body": {
            "type": "box",
            "layout": "vertical",
            "contents": [
              {
                "type": "text",
                "text": "Happy New Year",
                "weight": "bold",
                "size": "xl",
                "align": "center"
              },
              {
                "type": "box",
                "layout": "baseline",
                "margin": "md",
                "contents": [
                  {
                    "type": "icon",
                    "size": "sm",
                    "url": "https://scdn.line-apps.com/n/channel_devcenter/img/fx/review_gold_star_28.png"
                  },
                  {
                    "type": "text",
                    "text": "2024 ",
                    "size": "sm",
                    "color": "#999999",
                    "margin": "md",
                    "flex": 0,
                    "align": "center"
                  },
                  {
                    "type": "icon",
                    "size": "sm",
                    "url": "https://scdn.line-apps.com/n/channel_devcenter/img/fx/review_gold_star_28.png"
                  }
                ],
                "spacing": "md",
                "justifyContent": "center"
              },
              {
                "type": "box",
                "layout": "vertical",
                "margin": "lg",
                "contents": [
                  {
                    "type": "text",
                    "wrap": true,
                    "color": "#666666",
                    "size": "sm",
                    "flex": 5,
                    "text": freeText,
                    "align": "center"
                  },
                  {
                    "type": "box",
                    "layout": "baseline",
                    "spacing": "sm",
                    "contents": [
                      {
                        "type": "text",
                        "text": "โดย",
                        "color": "#aaaaaa",
                        "size": "sm",
                        "flex": 1
                      },
                      {
                        "type": "text",
                        "text": profile.displayName,
                        "wrap": true,
                        "color": "#666666",
                        "size": "sm",
                        "flex": 5
                      }
                    ]
                  },
                  {
                    "type": "box",
                    "layout": "vertical",
                    "contents": [
                      {
                        "type": "image",
                        "url": profile.pictureUrl,
                        "animated": false,
                        "offsetTop": "lg",
                        "size": "lg"
                      }
                    ],
                    "cornerRadius": "lg"
                  }
                ]
              }
            ],
            "alignItems": "center"
          }
        }
      };

      // แปลง Flex Message เป็น JSON string
      const flexMessageJson = JSON.stringify(flexMessage, null, 2); //  null, 2  ใช้สำหรับ format JSON ให้อ่านง่าย

      // แสดงผล JSON string ใน element ที่มี id="flexMessageJson"
      document.getElementById("flexMessageJson").textContent = flexMessageJson;

      // แชร์ Flex Message
      await liff.shareTargetPicker([flexMessage]);
    }

    async function getUserProfile() {
      const profile = await liff.getProfile()
      document.getElementById("pictureUrl").src = profile.pictureUrl
      document.getElementById("userId").append(profile.userId)
      document.getElementById("statusMessage").append(profile.statusMessage)
      document.getElementById("displayName").append(profile.displayName)
      document.getElementById("decodedIDToken").append(liff.getDecodedIDToken().email)
    }


    async function main() {
      await liff.init({
        liffId: "1657677472-y0LADGlq" // **อย่าลืมแก้ไข liffId ให้ถูกต้อง**
      })
      document.getElementById("isLoggedIn").append(liff.isLoggedIn())
      if (liff.isLoggedIn()) {
        getUserProfile()
      } else {
        liff.login()
      }
      // enable ปุ่ม
      document.getElementById('shareButton').disabled = false;
    }

    main();

    // เพิ่ม event listener ให้กับปุ่ม
    document.getElementById('shareButton').addEventListener('click', shareMsg);
  </script>
</body>
</html>
