<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö LINE UID</title>
  <link rel="stylesheet" href="css/formstyle1.css">
  <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <div class="circleTopLeft"></div>
  <div class="bottomRight">
    <div class="circleBottomRight"></div>
  </div>
  
  <div class="main-container">
    <div class="header">
      <h1>üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö UID</h1>
      <p>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô LINE ‡∏à‡∏≤‡∏Å UID</p>
    </div>
    
    <div class="card">
      <!-- ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å -->
      <div id="setupSection">
        <div class="input-group">
          <label for="accessTokenInput">üîë Channel Access Token</label>
          <div class="input-wrapper">
            <input 
              type="password" 
              id="accessTokenInput" 
              placeholder="‡πÉ‡∏™‡πà Channel Access Token ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì"
              autocomplete="off"
            >
          </div>
        </div>
        <button class="btn btn-primary" onclick="saveToken()">
          ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Token
        </button>
        
        <div class="warning-box">
          <strong>‚ö†Ô∏è ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:</strong>
          ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Production ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ Access Token ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô Browser 
          ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ Demo ‡∏´‡∏£‡∏∑‡∏≠ Internal Use ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
        </div>
      </div>
      
      <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö UID -->
      <div id="mainSection" style="display: none;">
        <div class="input-group">
          <label for="uidInput">‡∏Å‡∏£‡∏≠‡∏Å LINE User ID</label>
          <div class="input-wrapper">
            <input 
              type="text" 
              id="uidInput" 
              placeholder="‡πÄ‡∏ä‡πà‡∏ô U1234567890abcdef1234567890abcdef"
              autocomplete="off"
            >
          </div>
          <div class="error-message" id="errorMessage">
            ‚ö†Ô∏è ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö UID ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ U ‡πÅ‡∏•‡∏∞‡∏°‡∏µ 33 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)
          </div>
        </div>
        
        <button class="btn btn-primary" id="checkBtn" onclick="checkUID()">
          ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö UID
        </button>
        
        <button class="btn btn-secondary" onclick="changeToken()">
          üîß ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Access Token
        </button>
        
        <div class="loading" id="loading">
          <div class="spinner"></div>
          <div class="loading-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
        </div>
        
        <div class="result-section" id="resultSection">
          <div class="profile-container">
            <img id="pictureUrl" class="profile-image" src="" alt="Profile Picture">
            <div class="profile-name" id="displayName">-</div>
            <div class="profile-uid" id="displayUid">-</div>
          </div>
          
          <button class="btn btn-secondary" id="sendLinkBtn" onclick="sendRewardLink()">
            üì§ ‡∏™‡πà‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£
    const STORAGE_KEY = 'line_channel_access_token';
    const REWARD_FORM_URL = 'https://your-reward-form.com/'; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô URL ‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    const LIFF_ID = 'YOUR_LIFF_ID'; // ‡πÉ‡∏™‡πà LIFF ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ LIFF)
    
    // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ token ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    window.onload = function() {
      const savedToken = localStorage.getItem(STORAGE_KEY);
      if (savedToken) {
        document.getElementById('setupSection').style.display = 'none';
        document.getElementById('mainSection').style.display = 'block';
      }
      
      // Initialize LIFF (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ)
      if (LIFF_ID !== '2006674119-1PVewxbp') {
        initializeLiff();
      }
    }
    
    // Initialize LIFF
    async function initializeLiff() {
      try {
        await liff.init({ liffId: LIFF_ID });
        console.log('LIFF initialized successfully');
        
        if (!liff.isLoggedIn()) {
          liff.login();
        }
      } catch (error) {
        console.error('LIFF initialization failed', error);
      }
    }
    
    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Access Token
    function saveToken() {
      const token = document.getElementById('accessTokenInput').value.trim();
      
      if (!token) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Access Token');
        return;
      }
      
      // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á localStorage
      localStorage.setItem(STORAGE_KEY, token);
      
      // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏•‡∏±‡∏Å
      document.getElementById('setupSection').style.display = 'none';
      document.getElementById('mainSection').style.display = 'block';
      
      // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤ input
      document.getElementById('accessTokenInput').value = '';
    }
    
    // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Token
    function changeToken() {
      if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Access Token ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
        localStorage.removeItem(STORAGE_KEY);
        document.getElementById('setupSection').style.display = 'block';
        document.getElementById('mainSection').style.display = 'none';
        document.getElementById('resultSection').classList.remove('show');
      }
    }
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö UID
    function validateUID(uid) {
      // LINE UID ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ U ‡πÅ‡∏•‡∏∞‡∏ï‡∏≤‡∏°‡∏î‡πâ‡∏ß‡∏¢ 32 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ (‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô 33 ‡∏ï‡∏±‡∏ß)
      const uidPattern = /^U[0-9a-f]{32}$/i;
      return uidPattern.test(uid);
    }
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö UID
    async function checkUID() {
      const uidInput = document.getElementById('uidInput');
      const errorMessage = document.getElementById('errorMessage');
      const loading = document.getElementById('loading');
      const resultSection = document.getElementById('resultSection');
      const checkBtn = document.getElementById('checkBtn');
      
      const uid = uidInput.value.trim();
      
      // ‡∏ã‡πà‡∏≠‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÄ‡∏î‡∏¥‡∏°
      resultSection.classList.remove('show');
      errorMessage.classList.remove('show');
      uidInput.classList.remove('error');
      
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö UID
      if (!validateUID(uid)) {
        uidInput.classList.add('error');
        errorMessage.classList.add('show');
        return;
      }
      
      // ‡πÅ‡∏™‡∏î‡∏á loading
      loading.classList.add('show');
      checkBtn.disabled = true;
      
      try {
        // ‡∏î‡∏∂‡∏á Access Token ‡∏à‡∏≤‡∏Å localStorage
        const accessToken = localStorage.getItem(STORAGE_KEY);
        
        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å LINE API
        const response = await fetch(`https://api.line.me/v2/bot/profile/${uid}`, {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${accessToken}`
          }
        });
        
        if (!response.ok) {
          throw new Error(`API Error: ${response.status}`);
        }
        
        const profileData = await response.json();
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
        displayProfile(profileData, uid);
        
      } catch (error) {
        console.error('Error fetching profile:', error);
        
        if (error.message.includes('401')) {
          alert('Access Token ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Token ‡πÉ‡∏´‡∏°‡πà');
        } else if (error.message.includes('404')) {
          alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ UID ‡∏ô‡∏µ‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö UID ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
        } else {
          alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + error.message);
        }
      } finally {
        loading.classList.remove('show');
        checkBtn.disabled = false;
      }
    }
    
    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
    function displayProfile(profile, uid) {
      // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ placeholder)
      const pictureUrl = profile.pictureUrl || 'https://via.placeholder.com/150/0064ff/FFFFFF?text=No+Image';
      document.getElementById('pictureUrl').src = pictureUrl;
      document.getElementById('displayName').textContent = profile.displayName || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠';
      document.getElementById('displayUid').textContent = uid;
      
      document.getElementById('resultSection').classList.add('show');
    }
    
    // ‡∏™‡πà‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
    async function sendRewardLink() {
      const uid = document.getElementById('uidInput').value.trim();
      const displayName = document.getElementById('displayName').textContent;
      
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
      const rewardFormUrl = `${REWARD_FORM_URL}?uid=${uid}`;
      
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á
      const message = `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡πà‡∏∞‡∏Ñ‡∏∏‡∏ì ${displayName}\n\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡πà‡∏∞\n${rewardFormUrl}`;
      
      try {
        // ‡∏•‡∏≠‡∏á‡∏™‡πà‡∏á‡∏ú‡πà‡∏≤‡∏ô LINE Messaging API
        const accessToken = localStorage.getItem(STORAGE_KEY);
        
        const response = await fetch('https://api.line.me/v2/bot/message/push', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${accessToken}`
          },
          body: JSON.stringify({
            to: uid,
            messages: [
              {
                type: 'text',
                text: message
              }
            ]
          })
        });
        
        if (response.ok) {
          alert('‚úÖ ‡∏™‡πà‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
        } else {
          throw new Error('Failed to send message');
        }
        
      } catch (error) {
        console.error('Error sending message:', error);
        
        // ‡∏ñ‡πâ‡∏≤‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
        if (navigator.clipboard) {
          await navigator.clipboard.writeText(message);
          alert('üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏Ñ‡∏•‡∏¥‡∏õ‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏•‡πâ‡∏ß\n‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ô‡∏≥‡πÑ‡∏õ‡∏™‡πà‡∏á‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ');
        } else {
          // ‡∏ñ‡πâ‡∏≤ clipboard ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
          prompt('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ:', message);
        }
      }
    }
    
    // Enter key support
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('uidInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          checkUID();
        }
      });
      
      document.getElementById('accessTokenInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          saveToken();
        }
      });
    });
    
    // Real-time validation
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('uidInput').addEventListener('input', function() {
        const errorMessage = document.getElementById('errorMessage');
        if (errorMessage.classList.contains('show')) {
          errorMessage.classList.remove('show');
          this.classList.remove('error');
        }
      });
    });
  </script>
</body>
</html>
