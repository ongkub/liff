<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="utf-8" />
    <title>Sharing-Loading</title>
    
    <link rel="stylesheet" href="style.css">

    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body style="background-color: #FFFFFF;">
    <div class="centerScreen">
        <img src="https://sparkth.io/wp-content/themes/spark-factor-theme/assets/images/spark-factor-logo.svg" width="400px" />
        <div>
            <h1>แชร์ข้อความให้เพื่อนของคุณ</h1>
        </div>
        <div class="container">
            <div class="progress2 progress-moved">
                <div class="progress-bar2"></div>
            </div>
        </div>
        <div>
            <p>Now Loading…</p>
            <p id="status-message" style="color: red; font-weight: bold;"></p>
        </div>
    </div>

    <div><div class="circleTopLeft"></div></div>
    <div class="bottomRight"><div class="circleBottomRight"></div></div>

    <script>
        async function main() {
            await liff.init({ liffId: "2004737575-0PBxkA7Z" });

            if (!liff.isLoggedIn()) {
                liff.login({ redirectUri: window.location.href });
                return;
            }

            if (!liff.isApiAvailable('shareTargetPicker')) {
                document.getElementById('status-message').textContent = "ไม่สามารถแชร์คอนเทนต์ได้";
                return;
            }

            try {
                const response = await fetch('https://ongkub.github.io/liff/shareflex/obj/flex-message.json');
                const flexMessage = await response.json();
                const result = await liff.shareTargetPicker([flexMessage]);

                if (result) {
                    // สำเร็จ
                } else {
                    console.log("ผู้ใช้ยกเลิกการแชร์");
                }
            } catch (error) {
                document.getElementById('status-message').textContent = "เกิดข้อผิดพลาด: " + error.message;
            } finally {
                liff.closeWindow();
            }
        }
        main();
    </script>
</body>
</html>
